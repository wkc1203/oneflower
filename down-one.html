<!DOCTYPE html>
<html lang = "en" >
<head >
  <meta charset = "UTF-8" >
  <meta name = "viewport"
        content = "width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no" >
  <title ></title >
  <link rel = "stylesheet" href = "./css/reset.css" >
  <link rel = "stylesheet" href = "./css/swiper.min.css" >
  <link rel = "stylesheet" href = "./css/down-one.css" >
</head >
<body >
<div class = "page" >
  <div class = "content" >
    <div class = "pic" ></div >
    <div class = "explain" >
      <p >下载“一宅一花”APP</p >
      <p >注册APP账号</p >
      <p >您将获得一宅一花提供的 <span >5元优惠券</span ></p >
    </div >
    <div class = "operate" >
      <div class = "inviteCode" >
        <span id = "inviteCode" class = "code" >EvR67o</span >
      </div >
      <div class = "btn link-button" >立即下载</div >
    </div >
  </div >
</div >
</body >
<script src = "./js/jquery.min.js" ></script >
<script src = "./js/swiper.min.js" ></script >
<script src = "./js/server.js" ></script >
<script >
  function getUrlParam () {
    var url        = location.search; //获取url中"?"符后的字串
    var theRequest = new Object();
    if (url.indexOf("?") !== -1) {
      var str = url.substr(1);
      strs    = str.split("&");
      for (var i = 0; i < strs.length; i++) {
        theRequest[strs[i].split("=")[0]] = (strs[i].split("=")[1]);
      }
    }
    return theRequest;
  }

  $('#inviteCode').html(getUrlParam().inviteCode ? getUrlParam().inviteCode : '')

  function isTencent () {
    var ua    = navigator.userAgent.toLowerCase();
    var isWx  = ua.indexOf('micromessenger') !== -1;
    var QQRex = new RegExp(/\s+QQ/ig)
    var isQQ  = QQRex.test(ua)

    return isWx || isQQ
  }

  function getOs () {
    var os = ''

    const ua      = navigator.userAgent
    const windows = ua.match(/(Windows Phone);?[\s\/]+([\d.]+)?/)
    const android = ua.match(/(Android);?[\s\/]+([\d.]+)?/)
    const ipad    = ua.match(/(iPad).*OS\s([\d_]+)/)
    const ipod    = ua.match(/(iPod)(.*OS\s([\d_]+))?/)
    const iphone  = !ipad && ua.match(/(iPhone\sOS|iOS)\s([\d_]+)/)

    if (windows) {
      os = 'windows'
    }

    if (android && !windows) {
      os = 'android'
    }

    if (ipad || iphone || ipod) {
      os = 'ios'
    }

    return os
  }

  $('.link-button').on('click', function (e) {
    e.preventDefault()
    var urlData    = getUrlParam()
    var inviteCode = urlData.inviteCode ? urlData.inviteCode : ''

    if (isTencent()) {
      window.location.href = './invent.html?inviteCode=' + inviteCode + '&way=1'
      return
    }

    if (getOs() === 'ios') {
      window.location.href = ios_download
    } else {
      window.location.href = android_download
    }
  })
</script >
</html >